# çŠ¶æ€æ¨¡å¼ State Pattern

## å®šä¹‰

**åŒºåˆ†äº‹ç‰©å†…éƒ¨çš„çŠ¶æ€ï¼Œäº‹ç‰©å†…éƒ¨çŠ¶æ€çš„æ”¹å˜å¾€å¾€ä¼šå¸¦æ¥äº‹ç‰©çš„è¡Œä¸ºæ”¹å˜ã€‚**

çŠ¶æ€æ¨¡å¼çš„å…³é”®æ˜¯æŠŠäº‹ç‰©çš„**æ¯ç§çŠ¶æ€éƒ½å°è£…æˆå•ç‹¬çš„ç±»**ï¼Œè·Ÿæ­¤ç§çŠ¶æ€æœ‰å…³çš„è¡Œä¸ºéƒ½è¢«å°è£…åœ¨è¿™ä¸ªç±»çš„å†…éƒ¨ï¼Œåªéœ€è¦åœ¨çŠ¶æ€ç±»çš„ç®¡ç†ç±»ä¸­ï¼ŒæŠŠæŸä¸ªè¯·æ±‚å§”æ‰˜ç»™å½“å‰çš„çŠ¶æ€å¯¹è±¡å³å¯ï¼Œè¯¥çŠ¶æ€å¯¹è±¡ä¼šè´Ÿè´£æ¸²æŸ“å®ƒè‡ªèº«çš„è¡Œä¸ºã€‚

## çŠ¶æ€æ¨¡å¼é€šç”¨ç»“æž„

- **çŠ¶æ€ç®¡ç†ç±»**ï¼šåœ¨è¿™ä¸ªæž„é€ å‡½æ•°å†…éƒ¨ï¼Œåˆå§‹åŒ–æ¯ç§çŠ¶æ€ç±»çš„å®žä¾‹ã€‚çŠ¶æ€ç®¡ç†è€…å°†æŒæœ‰è¿™äº›çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥ä¾¿æŠŠè¯·æ±‚å§”æ‰˜ç»™çŠ¶æ€å¯¹è±¡ã€‚
- **å„ä¸ªçŠ¶æ€ç±»ï¼š** å°†æ¯ç§çŠ¶æ€å°è£…æˆå•ç‹¬çš„ç±»ï¼Œä¸Žæ­¤çŠ¶æ€æœ‰å…³çš„è¡Œä¸ºéƒ½å°è£…åœ¨è¿™ä¸ªç±»çš„å†…éƒ¨ã€‚

## çŠ¶æ€æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹

### ä¼˜ç‚¹

1. å°†ä¸åŒçŠ¶æ€çš„è¡Œä¸ºåˆ†å‰²å¼€æ¥ï¼Œæ»¡è¶³â€œå•ä¸€èŒè´£åŽŸåˆ™â€ã€‚
2. å°†ä¸åŒçš„çŠ¶æ€å¼•å…¥ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä¼šä½¿å¾—çŠ¶æ€è½¬æ¢å˜å¾—æ›´åŠ æ˜Žç¡®ï¼Œä¸”å‡å°‘å¯¹è±¡é—´çš„ç›¸äº’ä¾èµ–ã€‚
3. æœ‰åˆ©äºŽç¨‹åºçš„æ‰©å±•ã€‚é€šè¿‡å®šä¹‰æ–°çš„å­ç±»å¾ˆå®¹æ˜“åœ°å¢žåŠ æ–°çš„çŠ¶æ€å’Œè½¬æ¢ã€‚

### ç¼ºç‚¹

1. çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢žåŠ ç³»ç»Ÿçš„ç±»ä¸Žå¯¹è±¡çš„ä¸ªæ•°ã€‚
2. å¯¹å¼€é—­åŽŸåˆ™çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ã€‚å¯¹äºŽå¯ä»¥åˆ‡æ¢çŠ¶æ€çš„çŠ¶æ€æ¨¡å¼ï¼Œå¢žåŠ æ–°çš„çŠ¶æ€ç±»éœ€è¦ä¿®æ”¹é‚£äº›è´Ÿè´£çŠ¶æ€è½¬æ¢çš„æºç 

## å®žçŽ°

### å®žä¾‹ï¼šç”µç¯ç¨‹åº ðŸš¥

**ç¬¬ä¸€æ­¥ï¼ŒçŠ¶æ€ç®¡ç†ç±»ï¼š**

é¦–å…ˆå®šä¹‰äº†`Light`ç±»ï¼Œåœ¨è¿™é‡Œä¹Ÿè¢«ç§°ä¸ºä¸Šä¸‹æ–‡(`Context`)ã€‚éšåŽåœ¨`Light`çš„æž„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¦åˆ›å»ºæ¯ä¸€ä¸ªçŠ¶æ€ç±»çš„å®žä¾‹å¯¹è±¡ï¼Œ`Context`å°†æŒæœ‰è¿™äº›çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥ä¾¿æŠŠè¯·æ±‚å§”æ‰˜ç»™çŠ¶æ€å¯¹è±¡ã€‚

```javascript
class Light {
  constructor() {
    this.states = [new GreenLight(), new RedLight(), new YellowLight()];
    this.button = this.states[0];
  }

  change() {
    const totalStates = this.states.length;
    let currentIndex = this.states.findIndex(light => light === this.current);
    if (currentIndex + 1 < totalStates) this.current = this.states[currentIndex + 1];
    else this.current = this.states[0];
  }

  init() {
    return this.current.init();
  }
}
```

**ç¬¬äºŒæ­¥ï¼Œå°è£…å„ä¸ªçŠ¶æ€ç±»ï¼š**

```javascript
// åŸºç±» Light
class Light {
  constructor(light) {
    this.light = light;
  }
}

// çº¢ç¯
class RedLight extends Light {
  constructor() {
    super("red");
  }

  init() {
    return "STOP";
  }
}

// é»„ç¯
class YellowLight extends Light {
  constructor() {
    super("yellow");
  }

  init() {
    return "STEADY";
  }
}

// ç»¿ç¯
class GreenLight extends Light {
  constructor() {
    super("green");
  }

  init() {
    return "GO";
  }
}
```

è¿™é‡Œå°è£…äº†ä¸‰ç§çŠ¶æ€çº¢ç»¿é»„ç¯ï¼Œå¹¶ä¸”æ¯ç§çŠ¶æ€æœ‰è‡ªå·±çš„è¡Œä¸ºã€‚

Usage:

```javascript
// usage
const trafficLight = new TrafficLight();

console.log(trafficLight.init()); // 'GO'
trafficLight.change();

console.log(trafficLight.init()); // 'STOP'
trafficLight.change();

console.log(trafficLight.init()); // 'STEADY'
trafficLight.change();

console.log(trafficLight.init()); // 'GO'
trafficLight.change();

console.log(trafficLight.init()); // 'STOP'
```

#### æ•èŽ·å¼‚å¸¸ï¼šç»§æ‰¿æŠ½è±¡çˆ¶ç±»

JavaScript æ—¢ä¸æ”¯æŒæŠ½è±¡ç±»ï¼ˆä¸èƒ½å®žä¾‹åŒ–ï¼Œåªæœ‰æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œä¹Ÿæ²¡æœ‰æŽ¥å£çš„æ¦‚å¿µã€‚æ‰€ä»¥åœ¨ä½¿ç”¨çŠ¶æ€æ¨¡å¼çš„æ—¶å€™è¦æ ¼å¤–å°å¿ƒï¼Œå¦‚æžœç¼–å†™ä¸€ä¸ªçŠ¶æ€å­ç±»æ—¶ï¼Œå¿˜è®°äº†ç»™è¿™ä¸ªçŠ¶æ€å­ç±»å®žçŽ° sign æ–¹æ³•ï¼Œåˆ™ä¼šåœ¨çŠ¶æ€åˆ‡æ¢çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚å› ä¸º Context æ€»æ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çŠ¶æ€å¯¹è±¡çš„ sign æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œè¦è®©æŠ½è±¡çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ç›´æŽ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸è‡³å°‘ä¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´å°±è¢«å‘çŽ°ã€‚

```javascript
// åŸºç±» Light
class Light {
  constructor(light) {
    this.light = light;
  }

  init() {
    throw new Error("å½“å‰ç±»è‡ªèº«åº”å®žçŽ°initå‡½æ•°");
  }
}
```

## çŠ¶æ€æ¨¡å¼ä¸Žç­–ç•¥æ¨¡å¼åŒºåˆ«

- ç›¸åŒç‚¹

  ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„ç›¸åŒç‚¹æ˜¯ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡ã€ä¸€äº›ç­–ç•¥æˆ–è€…çŠ¶æ€ç±»ï¼Œä¸Šä¸‹æ–‡æŠŠè¯·æ±‚å§”æ‰˜ç»™è¿™äº›ç±»æ¥æ‰§è¡Œã€‚

- ä¸åŒç‚¹

  å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ç­–ç•¥æ¨¡å¼ä¸­çš„å„ä¸ªç­–ç•¥ç±»ä¹‹é—´æ˜¯å¹³ç­‰åˆå¹³è¡Œçš„ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ï¼Œæ‰€ä»¥å®¢æˆ·å¿…é¡»ç†ŸçŸ¥è¿™äº›ç­–ç•¥ç±»çš„ä½œç”¨ï¼Œä»¥ä¾¿å®¢æˆ·éšæ—¶å¯ä»¥ä¸»åŠ¨åˆ‡æ¢ç®—æ³•ï¼›è€Œåœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼ŒçŠ¶æ€å’ŒçŠ¶æ€å¯¹åº”çš„è¡Œä¸ºæ˜¯æ—©å·²è¢«å°è£…å¥½çš„ï¼ŒçŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢ä¹Ÿæ—©è¢«è§„å®šå®Œæˆï¼Œâ€œæ”¹å˜è¡Œä¸ºâ€è¿™ä»¶äº‹æƒ…åœ¨çŠ¶æ€å†…éƒ¨ã€‚
